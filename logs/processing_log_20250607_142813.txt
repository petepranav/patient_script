================================================================================
â•‘                            FINAL VERSION PROCESSOR                             â•‘
================================================================================
[14:28:13] â„¹ï¸  CSV Data Extraction & API Push Tool
[14:28:13] â„¹ï¸  
[14:28:13] â„¹ï¸  Features:
[14:28:13] â„¹ï¸  - 2 Robust text extraction methods (PDFPlumber + Tesseract OCR)
[14:28:13] â„¹ï¸  - AI-powered patient and order data extraction
[14:28:13] â„¹ï¸  - Enhanced error handling and logging
[14:28:13] â„¹ï¸  - Full API integration (patient creation + order pushing)
[14:28:13] â„¹ï¸  - CSV output with comprehensive patient data
[14:28:13] â„¹ï¸  - Detailed API tracking with remarks for every document
[14:28:13] â„¹ï¸  - Complete audit trail of all processing attempts
[14:28:13] â„¹ï¸  
[14:28:13] â„¹ï¸  Starting CSV processing with API integration: hawthorn_fam.csv
[14:28:13] âœ… Created output CSV file: csv_outputs/extracted_patients_20250607_142813.csv
[14:28:13] âœ… Created API details CSV file: api_outputs/api_push_details_20250607_142813.csv
================================================================================
â•‘                        Processing Document ID: 2175968                         â•‘
================================================================================
[14:28:13] â„¹ï¸  Agency: Guardian Home Health Care LLC - West Bridgewater
[14:28:13] â„¹ï¸  Date: 05/09/2025
[14:28:13] ğŸ”„ 
ğŸ”„ Step 1: Extracting text from PDF...
[14:28:17] [DOC: 2175968] âŒ Critical failure in get_pdf_text: Invalid response format
[14:28:17] âŒ Failed to extract text for Doc ID 2175968
[14:28:17] [DOC: 2175968] â„¹ï¸  API push details saved for document 2175968
================================================================================
â•‘                        Processing Document ID: 9285144                         â•‘
================================================================================
[14:28:17] â„¹ï¸  Agency: Dartmouth HH
[14:28:17] â„¹ï¸  Date: 05/09/2025
[14:28:17] ğŸ”„ 
ğŸ”„ Step 1: Extracting text from PDF...
[14:28:19] [DOC: 9285144] âœ… Text extracted using pdfplumber (1746 chars)
[14:28:19] âœ…    âœ… Text extracted using pdfplumber (1746 chars)
[14:28:19] ğŸ”„ 
ğŸ”„ Step 2: Extracting patient data...
[14:28:22] â„¹ï¸  AI extracted raw sex value: 'F'
[14:28:22] â„¹ï¸  AI extracted service line: 'HHA'
[14:28:22] â„¹ï¸  AI extracted payer source: 'Senior Whole Health'
[14:28:22] â„¹ï¸  AI extracted diagnoses:
[14:28:22] â„¹ï¸    - Diagnosis 1: ''
[14:28:22] â„¹ï¸    - Diagnosis 2: ''
[14:28:22] â„¹ï¸    - Diagnosis 3: ''
[14:28:22] â„¹ï¸    - Diagnosis 4: ''
[14:28:22] â„¹ï¸    - Diagnosis 5: ''
[14:28:22] â„¹ï¸    - Diagnosis 6: ''
[14:28:22] â„¹ï¸  Final extracted MRN: '1508015'
[14:28:22] â„¹ï¸  Final extracted Sex: 'FEMALE'
[14:28:22] â„¹ï¸  Final extracted Service Line: 'HHA'
[14:28:22] â„¹ï¸  Final extracted Payer Source: 'Senior Whole Health'
[14:28:22] âœ… Patient data extraction completed successfully
[14:28:22] âœ…    âœ… Patient data extracted successfully
[14:28:22] ğŸ“Š Patient Response
     â””â”€ patientFName: Paula
     â””â”€ patientLName: Hatch
     â””â”€ dob: 06/22/1940
     â””â”€ patientSex: FEMALE
     â””â”€ medicalRecordNo: 1508015
     â””â”€ billingProvider: Hawthorn Medical Associates
     â””â”€ npi: 
     â””â”€ physicianNPI: 
     â””â”€ nameOfAgency: Community Nurse Inc
     â””â”€ address: 14 Twelfth St
     â””â”€ city: Onset
     â””â”€ state: MA
     â””â”€ zip: 02558
     â””â”€ email: 
     â””â”€ phoneNumber: (508) 992-6278
     â””â”€ serviceLine: HHA
     â””â”€ payorSource: Senior Whole Health
     â””â”€ episodeDiagnoses: [{'startOfCare': '03/23/2024', 'startOfEpisode': '03/18/2025', 'endOfEpisode': '05/16/2025', 'firstDiagnosis': '', 'secondDiagnosis': '', 'thirdDiagnosis': '', 'fourthDiagnosis': '', 'fifthDiagnosis': '', 'sixthDiagnosis': ''}]
[14:28:22] âœ…    âœ… Patient identified: Paula Hatch
[14:28:22] âœ…    âœ… Patient name validation passed
[14:28:22] ğŸ”„ 
ğŸ”„ Step 3: Processing patient dates...
[14:28:22] [DOC: 9285144] â„¹ï¸  DOB normalized: 06/22/1940
[14:28:22] [DOC: 9285144] â„¹ï¸  Episode startOfCare normalized: 03/23/2024
[14:28:22] [DOC: 9285144] â„¹ï¸  Episode startOfEpisode normalized: 03/18/2025
[14:28:22] [DOC: 9285144] â„¹ï¸  Episode endOfEpisode normalized: 05/16/2025
[14:28:22] [DOC: 9285144] âœ… Patient date processing completed successfully
[14:28:22] âœ…    âœ… Date processing completed
[14:28:22] ğŸ“Š Processed Patient Data
     â””â”€ patientFName: Paula
     â””â”€ patientLName: Hatch
     â””â”€ dob: 06/22/1940
     â””â”€ patientSex: FEMALE
     â””â”€ medicalRecordNo: 1508015
     â””â”€ billingProvider: Hawthorn Medical Associates
     â””â”€ npi: 
     â””â”€ physicianNPI: 
     â””â”€ nameOfAgency: Community Nurse Inc
     â””â”€ address: 14 Twelfth St
     â””â”€ city: Onset
     â””â”€ state: MA
     â””â”€ zip: 02558
     â””â”€ email: 
     â””â”€ phoneNumber: (508) 992-6278
     â””â”€ serviceLine: HHA
     â””â”€ payorSource: Senior Whole Health
     â””â”€ episodeDiagnoses: [{'startOfCare': '03/23/2024', 'startOfEpisode': '03/18/2025', 'endOfEpisode': '05/16/2025', 'firstDiagnosis': '', 'secondDiagnosis': '', 'thirdDiagnosis': '', 'fourthDiagnosis': '', 'fifthDiagnosis': '', 'sixthDiagnosis': ''}]
[14:28:22] ğŸ”„ 
ğŸ”„ Step 4: Extracting order data...
[14:28:23] âš ï¸  AI extraction attempt 1 failed: 400 API key expired. Please renew the API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key expired. Please renew the API key."
]
[14:28:26] â„¹ï¸  Order extraction - MRN: ''
[14:28:26] â„¹ï¸  Order extraction - Sex: 'FEMALE'
[14:28:26] â„¹ï¸  Order extraction - Service Line: ''
[14:28:26] â„¹ï¸  Order extraction - Payer Source: 'Senior Whole Health'
[14:28:26] âœ… Order data extraction completed successfully
[14:28:26] ğŸ”„ 
ğŸ”„ Step 4.5: Merging patient and order data...
[14:28:26] â„¹ï¸  Using MRN from patient data: '1508015'
[14:28:26] â„¹ï¸  Using service line from patient data: 'HHA'
[14:28:26] â„¹ï¸  Payer source consistent in both sources: 'Senior Whole Health'
[14:28:26] âœ… Patient name cross-validation successful
[14:28:26] âœ…    âœ… Data merged successfully
[14:28:28] âœ…    âœ… Order data extracted and validated
[14:28:28] ğŸ”„ 
ğŸ”„ Step 5: Checking/Creating patient...
[14:28:28] [DOC: 9285144] âœ… Patient found in local cache: Paula Hatch, ID: 7e9f0551-7213-4bc8-8b8b-ae0e8ddfecc3
[14:28:28] âœ…    âœ… Existing patient found with ID: 7e9f0551-7213-4bc8-8b8b-ae0e8ddfecc3
[14:28:28] ğŸ”„ 
ğŸ”„ Step 6: Pushing order to API...
[14:28:28] [DOC: 9285144] â„¹ï¸  Pushing order via API for patient ID: 7e9f0551-7213-4bc8-8b8b-ae0e8ddfecc3
[14:28:29] [DOC: 9285144] âŒ Order push failed with status 409: {"message":"Duplicate order found","orderId":"ORD13832"}
[14:28:29] âŒ    âŒ Failed to push order
[14:28:29] ğŸ”„ 
ğŸ”„ Step 7: Writing to CSV...
[14:28:29] [DOC: 9285144] â„¹ï¸  Calculated age: 84 from DOB: 06/22/1940
[14:28:29] [DOC: 9285144] â„¹ï¸  Service Line extracted: 'HHA'
[14:28:29] [DOC: 9285144] â„¹ï¸  Payer Source extracted: 'Senior Whole Health'
[14:28:29] [DOC: 9285144] â„¹ï¸  Diagnosis codes being written:
[14:28:29] [DOC: 9285144] â„¹ï¸    - Latest_Episode_Firstdiagnosis: ''
[14:28:29] [DOC: 9285144] â„¹ï¸    - Latest_Episode_Seconddiagnosis: ''
[14:28:29] [DOC: 9285144] â„¹ï¸    - Latest_Episode_Thirddiagnosis: ''
[14:28:29] [DOC: 9285144] â„¹ï¸    - Latest_Episode_Fourthdiagnosis: ''
[14:28:29] [DOC: 9285144] â„¹ï¸    - Latest_Episode_Fifthdiagnosis: ''
[14:28:29] [DOC: 9285144] â„¹ï¸    - Latest_Episode_Sixthdiagnosis: ''
[14:28:29] [DOC: 9285144] âœ… Patient data written to CSV: Paula Hatch | Sex: FEMALE | Age: 84 | Service: HHA | Payer: Senior Whole Health | MRN: 1508015
[14:28:29] âœ…    âœ… Document 9285144 processed and saved successfully
[14:28:29] ğŸ”„ 
ğŸ”„ Step 8: Saving API details...
[14:28:29] [DOC: 9285144] â„¹ï¸  API push details saved for document 9285144
[14:28:29] âœ…    âœ… API details saved
================================================================================
â•‘                        Processing Document ID: 9284891                         â•‘
================================================================================
[14:28:29] â„¹ï¸  Agency: Dartmouth HH
[14:28:29] â„¹ï¸  Date: 05/09/2025
[14:28:29] ğŸ”„ 
ğŸ”„ Step 1: Extracting text from PDF...
[14:28:31] [DOC: 9284891] âœ… Text extracted using pdfplumber (1588 chars)
[14:28:31] âœ…    âœ… Text extracted using pdfplumber (1588 chars)
[14:28:31] ğŸ”„ 
ğŸ”„ Step 2: Extracting patient data...
[14:28:31] âš ï¸  AI extraction attempt 1 failed: 400 API key expired. Please renew the API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key expired. Please renew the API key."
]
[14:28:32] âš ï¸  AI extraction attempt 2 failed: 400 API key expired. Please renew the API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key expired. Please renew the API key."
]
[14:28:34] âš ï¸  AI extraction attempt 3 failed: 400 API key expired. Please renew the API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key expired. Please renew the API key."
]
[14:28:34] âŒ All AI extraction attempts failed
[14:28:34] âš ï¸  AI extraction failed, returning minimal patient data structure
[14:28:34] âœ…    âœ… Patient data extracted successfully
[14:28:34] ğŸ“Š Patient Response
     â””â”€ patientFName: 
     â””â”€ patientLName: 
     â””â”€ dob: 
     â””â”€ patientSex: 
     â””â”€ medicalRecordNo: 
     â””â”€ billingProvider: 
     â””â”€ npi: 
     â””â”€ physicianNPI: 
     â””â”€ nameOfAgency: 
     â””â”€ address: 
     â””â”€ city: 
     â””â”€ state: 
     â””â”€ zip: 
     â””â”€ email: 
     â””â”€ phoneNumber: 
     â””â”€ serviceLine: 
     â””â”€ payorSource: 
     â””â”€ episodeDiagnoses: [{'startOfCare': '', 'startOfEpisode': '', 'endOfEpisode': '', 'firstDiagnosis': '', 'secondDiagnosis': '', 'thirdDiagnosis': '', 'fourthDiagnosis': '', 'fifthDiagnosis': '', 'sixthDiagnosis': ''}]
[14:28:34] âš ï¸     âŒ Insufficient patient data extracted
[14:28:34] [DOC: 9284891] â„¹ï¸  API push details saved for document 9284891
================================================================================
â•‘                        Processing Document ID: 9285057                         â•‘
================================================================================
[14:28:34] â„¹ï¸  Agency: Southcoast VNA â€“ Community Office (Fairhaven)
[14:28:34] â„¹ï¸  Date: 05/09/2025
[14:28:34] ğŸ”„ 
ğŸ”„ Step 1: Extracting text from PDF...

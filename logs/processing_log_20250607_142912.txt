================================================================================
║                            FINAL VERSION PROCESSOR                             ║
================================================================================
[14:29:12] ℹ️  CSV Data Extraction & API Push Tool
[14:29:12] ℹ️  
[14:29:12] ℹ️  Features:
[14:29:12] ℹ️  - 2 Robust text extraction methods (PDFPlumber + Tesseract OCR)
[14:29:12] ℹ️  - AI-powered patient and order data extraction
[14:29:12] ℹ️  - Enhanced error handling and logging
[14:29:12] ℹ️  - Full API integration (patient creation + order pushing)
[14:29:12] ℹ️  - CSV output with comprehensive patient data
[14:29:12] ℹ️  - Detailed API tracking with remarks for every document
[14:29:12] ℹ️  - Complete audit trail of all processing attempts
[14:29:12] ℹ️  
[14:29:12] ℹ️  Starting CSV processing with API integration: hawthorn_fam.csv
[14:29:12] ✅ Created output CSV file: csv_outputs/extracted_patients_20250607_142912.csv
[14:29:12] ✅ Created API details CSV file: api_outputs/api_push_details_20250607_142912.csv
================================================================================
║                        Processing Document ID: 2175968                         ║
================================================================================
[14:29:12] ℹ️  Agency: Guardian Home Health Care LLC - West Bridgewater
[14:29:12] ℹ️  Date: 05/09/2025
[14:29:12] 🔄 
🔄 Step 1: Extracting text from PDF...
[14:29:14] [DOC: 2175968] ❌ Critical failure in get_pdf_text: Invalid response format
[14:29:14] ❌ Failed to extract text for Doc ID 2175968
[14:29:14] [DOC: 2175968] ℹ️  API push details saved for document 2175968
================================================================================
║                        Processing Document ID: 9285144                         ║
================================================================================
[14:29:14] ℹ️  Agency: Dartmouth HH
[14:29:14] ℹ️  Date: 05/09/2025
[14:29:14] 🔄 
🔄 Step 1: Extracting text from PDF...
[14:29:16] [DOC: 9285144] ✅ Text extracted using pdfplumber (1746 chars)
[14:29:16] ✅    ✅ Text extracted using pdfplumber (1746 chars)
[14:29:16] 🔄 
🔄 Step 2: Extracting patient data...
[14:29:19] ℹ️  AI extracted raw sex value: 'F'
[14:29:19] ℹ️  AI extracted service line: 'HHA'
[14:29:19] ℹ️  AI extracted payer source: 'Senior Whole Health'
[14:29:19] ℹ️  AI extracted diagnoses:
[14:29:19] ℹ️    - Diagnosis 1: 'None'
[14:29:19] ℹ️    - Diagnosis 2: 'None'
[14:29:19] ℹ️    - Diagnosis 3: 'None'
[14:29:19] ℹ️    - Diagnosis 4: 'None'
[14:29:19] ℹ️    - Diagnosis 5: 'None'
[14:29:19] ℹ️    - Diagnosis 6: 'None'
[14:29:19] ℹ️  Final extracted MRN: '1508015'
[14:29:19] ℹ️  Final extracted Sex: 'FEMALE'
[14:29:19] ℹ️  Final extracted Service Line: 'HHA'
[14:29:19] ℹ️  Final extracted Payer Source: 'Senior Whole Health'
[14:29:19] ✅ Patient data extraction completed successfully
[14:29:19] ✅    ✅ Patient data extracted successfully
[14:29:19] 📊 Patient Response
     └─ patientFName: Paula
     └─ patientLName: Hatch
     └─ dob: 06/22/1940
     └─ patientSex: FEMALE
     └─ medicalRecordNo: 1508015
     └─ billingProvider: Hawthorn Medical Associates
     └─ npi: 
     └─ physicianNPI: 
     └─ nameOfAgency: Community Nurse Inc
     └─ address: 62 Center Street
     └─ city: Fairhaven
     └─ state: MA
     └─ zip: 02719
     └─ email: None
     └─ phoneNumber: (508) 992-6278
     └─ serviceLine: HHA
     └─ payorSource: Senior Whole Health
     └─ episodeDiagnoses: [{'startOfCare': '03/23/2024', 'startOfEpisode': '03/18/2025', 'endOfEpisode': '05/16/2025', 'firstDiagnosis': None, 'secondDiagnosis': None, 'thirdDiagnosis': None, 'fourthDiagnosis': None, 'fifthDiagnosis': None, 'sixthDiagnosis': None}]
[14:29:19] ✅    ✅ Patient identified: Paula Hatch
[14:29:19] ✅    ✅ Patient name validation passed
[14:29:19] 🔄 
🔄 Step 3: Processing patient dates...
[14:29:19] [DOC: 9285144] ℹ️  DOB normalized: 06/22/1940
[14:29:19] [DOC: 9285144] ℹ️  Episode startOfCare normalized: 03/23/2024
[14:29:19] [DOC: 9285144] ℹ️  Episode startOfEpisode normalized: 03/18/2025
[14:29:19] [DOC: 9285144] ℹ️  Episode endOfEpisode normalized: 05/16/2025
[14:29:19] [DOC: 9285144] ✅ Patient date processing completed successfully
[14:29:19] ✅    ✅ Date processing completed
[14:29:19] 📊 Processed Patient Data
     └─ patientFName: Paula
     └─ patientLName: Hatch
     └─ dob: 06/22/1940
     └─ patientSex: FEMALE
     └─ medicalRecordNo: 1508015
     └─ billingProvider: Hawthorn Medical Associates
     └─ npi: 
     └─ physicianNPI: 
     └─ nameOfAgency: Community Nurse Inc
     └─ address: 62 Center Street
     └─ city: Fairhaven
     └─ state: MA
     └─ zip: 02719
     └─ phoneNumber: (508) 992-6278
     └─ serviceLine: HHA
     └─ payorSource: Senior Whole Health
     └─ episodeDiagnoses: [{'startOfCare': '03/23/2024', 'startOfEpisode': '03/18/2025', 'endOfEpisode': '05/16/2025'}]
[14:29:19] 🔄 
🔄 Step 4: Extracting order data...
[14:29:19] ⚠️  AI extraction attempt 1 failed: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 500
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 41
}
]
[14:29:23] ℹ️  Order extraction - MRN: ''
[14:29:23] ℹ️  Order extraction - Sex: 'FEMALE'
[14:29:23] ℹ️  Order extraction - Service Line: ''
[14:29:23] ℹ️  Order extraction - Payer Source: 'Senior Whole Health'
[14:29:23] ✅ Order data extraction completed successfully
[14:29:23] 🔄 
🔄 Step 4.5: Merging patient and order data...
[14:29:23] ℹ️  Using MRN from patient data: '1508015'
[14:29:23] ℹ️  Using service line from patient data: 'HHA'
[14:29:23] ℹ️  Payer source consistent in both sources: 'Senior Whole Health'
[14:29:23] ✅ Patient name cross-validation successful
[14:29:23] ✅    ✅ Data merged successfully
[14:29:24] ✅    ✅ Order data extracted and validated
[14:29:24] 🔄 
🔄 Step 5: Checking/Creating patient...
[14:29:24] [DOC: 9285144] ✅ Patient found in local cache: Paula Hatch, ID: 7e9f0551-7213-4bc8-8b8b-ae0e8ddfecc3
[14:29:24] ✅    ✅ Existing patient found with ID: 7e9f0551-7213-4bc8-8b8b-ae0e8ddfecc3
[14:29:24] 🔄 
🔄 Step 6: Pushing order to API...
[14:29:24] [DOC: 9285144] ℹ️  Pushing order via API for patient ID: 7e9f0551-7213-4bc8-8b8b-ae0e8ddfecc3
